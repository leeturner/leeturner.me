<!DOCTYPE html>
<html lang="en-us">
<head>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="description" content="Lead Backend Developer at Crunch, Snyk Ambassador, Hacker of code. Appsec enthusiast. Runs Brighton Kotlin &amp; Brighton JUG">


<title>
  BlinkyTape JUnit Testwatcher API Implementation - Lee Turner  
</title>


<meta name="author" content="Lee Turner">


<meta name="generator" content="Hugo 0.92.0" />


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/default.min.css">


<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Roboto+Slab:wght@400;700&family=Roboto:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/custom.css">




<link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" href="/favicon/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicon/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/favicon/manifest.json">
<link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5">
<meta name="theme-color" content="#ffffff">

</head>
<body lang="en-us">
<div class="container">



<section id="main-menu-pane" class="text-center main-menu">
  <ul>
    
    <li><a class="menu-item" href="/">Home</a></li>
    
    <li><a class="menu-item" href="/about/">About</a></li>
    
    <li><a class="menu-item" href="https://leeturner.tech">Resume</a></li>
    
    <li><a class="menu-item" href="/posts/">Posts</a></li>
    
    <li><a class="menu-item" href="/projects/">Projects</a></li>
    
    <li><a class="menu-item" href="/brighton-kotlin">Brighton Kotlin</a></li>
    
  </ul>
</section>



<header class="text-left title">
  <h1 class="title">BlinkyTape JUnit Testwatcher API Implementation</h1>
</header>
<section id="category-pane" class="meta">
  
  <div class="col-md-12">
    <h6 class="text-left meta">
        PUBLISHED ON APR 6, 2021 
      
    </h6>
  </div>
  
</section>
<section id="content-pane" class="">
  <div class="col-md-12 text-justify content">
    <p><a href="/posts/building-a-camel-case-junit5-displaynamegenerator/">Every so often</a> I like to have a play around with a part of <a href="https://junit.org"> Junit </a> that I haven&rsquo;t used before, and I recently decided to look into the <a href="https://junit.org/junit5/docs/5.5.1/api/org/junit/jupiter/api/extension/TestWatcher.html">TestWatcher API</a>.</p>
<p>I have to admit that I have been meaning to play with this for quite a while now&hellip;. I just haven&rsquo;t really found a good use-case for it. Given that I decided to quit trying to find a good use-case and implement something nerdy instead.</p>
<p>Stretched across the back of the desk in front of me is a <a href="https://shop.blinkinlabs.com/collections/frontpage/products/blinkytape-basic_"> BlinkyTape </a> attached to my usb hub.  Most of the time the BlinkyTape is just used for a bit of subtle lighting behind my monitor but while looking into the Junit TestWatcher API, it suddenly hit me&hellip;. maybe I could combine the two.</p>
<p>I already had a <a href="https://github.com/leeturner/night-fever">bit of code</a> to interact directly with the BlinkyTape so all I needed to do was figure out how to tracks the success, failure or whether a test is disabled.  If I could do that I could then turn the BlinkyTape green, red or orange.</p>
<p>I put together a simple Kotlin implementation of the TestWatcher API that adds a test result status to a list:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BlinkyTapeTestWatcher</span> : TestWatcher, AfterAllCallback {

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> testResultsStatus = mutableListOf&lt;TestResultStatus&gt;()

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">testDisabled</span>(context: ExtensionContext, reason: Optional&lt;String&gt;) {
        <span style="color:#66d9ef">this</span>.testResultsStatus.add(TestResultStatus.DISABLED)
    }

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">testSuccessful</span>(context: ExtensionContext) {
        <span style="color:#66d9ef">this</span>.testResultsStatus.add(TestResultStatus.SUCCESS)
    }

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">testAborted</span>(context: ExtensionContext, cause: Throwable?) {
        <span style="color:#66d9ef">this</span>.testResultsStatus.add(TestResultStatus.ABORTED)
    }

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">testFailed</span>(context: ExtensionContext, cause: Throwable?) {
        <span style="color:#66d9ef">this</span>.testResultsStatus.add(TestResultStatus.FAILED)
    }

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">afterAll</span>(extensionContext: ExtensionContext) {
        <span style="color:#75715e">// first lets check to see if we have any test failures so we can leave the blinky tape as red
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.testResultsStatus.any { <span style="color:#66d9ef">it</span> <span style="color:#f92672">==</span> TestResultStatus.FAILED }) {
            <span style="color:#66d9ef">this</span>.renderFrame(RED_BLINKY_TAPE_FRAME)
            <span style="color:#66d9ef">return</span>
        }

        <span style="color:#75715e">// if no test failures then we can take a look to see if there are any disabled tests.  If there are then
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// we can set the blinky tape to orange
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.testResultsStatus.any { <span style="color:#66d9ef">it</span> <span style="color:#f92672">==</span> TestResultStatus.DISABLED }) {
            <span style="color:#66d9ef">this</span>.renderFrame(ORANGE_BLINKY_TAPE_FRAME)
            <span style="color:#66d9ef">return</span>
        }

        <span style="color:#75715e">// if no failures or disabled tests then we can set the blinky tape to green
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.testResultsStatus.any { <span style="color:#66d9ef">it</span> <span style="color:#f92672">==</span> TestResultStatus.SUCCESS }) {
            <span style="color:#66d9ef">this</span>.renderFrame(GREEN_BLINKY_TAPE_FRAME)
            <span style="color:#66d9ef">return</span>
        }
    }

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">renderFrame</span>(frame: BlinkyTapeFrame) {
        <span style="color:#66d9ef">val</span> controller = BlinkyTapeController()
        controller.renderFrame(frame)
        controller.close()
    }

    <span style="color:#66d9ef">companion</span> <span style="color:#66d9ef">object</span> {
        <span style="color:#66d9ef">val</span> ORANGE_BLINKY_TAPE_FRAME = BlinkyTapeFrame(defaultColour = Color.ORANGE)
        <span style="color:#66d9ef">val</span> RED_BLINKY_TAPE_FRAME = BlinkyTapeFrame(defaultColour = Color.RED)
        <span style="color:#66d9ef">val</span> GREEN_BLINKY_TAPE_FRAME = BlinkyTapeFrame(defaultColour = Color.GREEN)
    }

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">enum</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestResultStatus</span> {
        SUCCESS, ABORTED, FAILED, DISABLED
    }
}
</code></pre></div><p>The <code>BlinkyTapeTestWatcher</code> class also implements the <code>AfterAllCallback</code> interface allows us to override a method called <code>afterAll</code> that is executed when all the tests have finished.</p>
<p>The <code>afterAll</code> method performs 3 checks:</p>
<ol>
<li>If any of the tests have failed it renders the BlinkyTape as all red</li>
<li>If non of the tests have failed but there were disabled tests it renders the BlinkyTape as all orange</li>
<li>If all of the tests pass then it renders the BlinkyTape as all green</li>
</ol>
<p>All in all it seemed to work out pretty well.  I uploaded the repo to github if you wanted to play around with this yourself - <a href="https://github.com/leeturner/BlinkyTapeTestWatcher">https://github.com/leeturner/BlinkyTapeTestWatcher</a></p>
<p>I uploaded a short video of this in action to twitter:</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Had a play with the <a href="https://twitter.com/junitteam?ref_src=twsrc%5Etfw">@junitteam</a> TestWatcher API today. Hooked it up to my Blinky Tape LED strip for a visual representation of my test status. Green for all tests passing, red for any failures and orange for all passing but some tests disabled. <a href="https://t.co/PezJ0PGb1V">pic.twitter.com/PezJ0PGb1V</a></p>&mdash; Lee Turner (@leeturner) <a href="https://twitter.com/leeturner/status/1371143550348505093?ref_src=twsrc%5Etfw">March 14, 2021</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

  </div>
</section>
<section id="tag-pane" class="meta">
  
  <div class="col-md-12">
    <h6 class="text-right meta">
      
      
      
      TAGS:
      
      
      <a class="meta" href="/tags/blinky">BLINKY</a>, 
      
      <a class="meta" href="/tags/blinkytape">BLINKYTAPE</a>, 
      
      <a class="meta" href="/tags/junit">JUNIT</a>, 
      
      <a class="meta" href="/tags/junit5">JUNIT5</a>, 
      
      <a class="meta" href="/tags/kotlin">KOTLIN</a>, 
      
      <a class="meta" href="/tags/testwatcher">TESTWATCHER</a>
      
      
      
    </h6>
  </div>
  
</section>




<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "leeturner-me" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>




<footer class="text-center footer">
  <hr />
  
  <h6 class="text-center copyright">© 2021. Lee Turner | <a href="/privacy">Privacy Policy</a></h6>
  
  <h6 class="text-center powered">Powered by <a href="https://gohugo.io/">Hugo  v0.92.0</a> &amp; <a href="https://github.com/shenoybr/hugo-goa">Goa</a>.</h6>
  
      
  
</footer>

</div>



<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/highlight.min.js"></script>
  

<script type="text/javascript">
  hljs.highlightAll();
</script>




<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-115883229-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://buttons.github.io/buttons.js"></script>
<script src="/js/main.js"></script>
<script src="/js/custom.js"></script>
</body>
</html>


